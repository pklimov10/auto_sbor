


# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ WildFly –∏ PostgreSQL
–°–∫—Ä–∏–ø—Ç –¥–ª—è –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ —Å–±–æ—Ä–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–∞–±–æ—Ç–µ WildFly –∏ PostgreSQL

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ
- [–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
- [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è](#—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
- [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ](#–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–¥–∞–Ω–Ω—ã—Ö)
- [Thread Dumps](#thread-dumps)
- [SQL –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](#sql-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
- [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å](#–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
- [–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫](#—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ-–Ω–µ–ø–æ–ª–∞–¥–æ–∫)
- [–õ–∏—Ü–µ–Ω–∑–∏—è](#–ª–∏—Ü–µ–Ω–∑–∏—è)

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –û–±—â–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
- –°–±–æ—Ä —Å–∏—Å—Ç–µ–º–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤
- –ê–Ω–∞–ª–∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ WildFly
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∞—Ä—Ö–∏–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

### Thread Dumps
- –°–±–æ—Ä thread dumps —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏
- –ê–Ω–∞–ª–∏–∑ deadlocks
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ memory pools
- –°–±–æ—Ä GC —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π heap dump –ø—Ä–∏ –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ
- –ê–Ω–∞–ª–∏–∑ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤

### SQL –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –ê–Ω–∞–ª–∏–∑ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—É–ª–æ–≤ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

### –õ–æ–≥–∏
- –°–±–æ—Ä –ª–æ–≥–æ–≤ WildFly
- –ê—Ä—Ö–∏–≤–∞—Ü–∏—è –ª–æ–≥–æ–≤
- –ê–Ω–∞–ª–∏–∑ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Linux/Unix-—Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è –û–°
- Bash 4.0+
- –î–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–Ω—ã–º –∫–æ–º–∞–Ω–¥–∞–º (tar, awk, sed, grep)

### Java
- Java 8 –∏–ª–∏ –≤—ã—à–µ
- –î–æ—Å—Ç—É–ø –∫ —É—Ç–∏–ª–∏—Ç–∞–º (jstack, jmap, jstat)
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è JAVA_HOME

### WildFly
- WildFly 10+
- –î–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º —Ñ–∞–π–ª–∞–º
- –ü—Ä–∞–≤–∞ –Ω–∞ —á—Ç–µ–Ω–∏–µ –ª–æ–≥–æ–≤

### PostgreSQL
- PostgreSQL 9.6+
- –î–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–Ω—ã–º —Ç–∞–±–ª–∏—Ü–∞–º
- –ü—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
```bash
git clone https://github.com/pklimov10/auto_sbor.git
```

2. –°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:
```bash
chmod +x monitoring.sh
```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```bash
./monitoring.sh check
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ –Ω–∞—á–∞–ª–µ —Å–∫—Ä–∏–ø—Ç–∞:
```bash
WFHOME=/–ø—É—Ç—å/–∫/wildfly          # –ü—É—Ç—å –¥–æ WildFly
ERRORHOME=/–ø—É—Ç—å/–¥–ª—è/–æ—Ç—á–µ—Ç–æ–≤     # –ö–∞—Ç–∞–ª–æ–≥ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç—á–µ—Ç–æ–≤
javahome=/–ø—É—Ç—å/–∫/java           # –ü—É—Ç—å –¥–æ Java
javaclass=/–ø—É—Ç—å/–∫/–∫–ª–∞—Å—Å–∞–º       # –ü—É—Ç—å –¥–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö Java-–∫–ª–∞—Å—Å–æ–≤
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
```bash
THREAD_DUMP_INTERVAL=10         # –ò–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É thread dumps (—Å–µ–∫)
MAX_DUMPS=5                     # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ thread dumps
HEAP_DUMP_THRESHOLD=80         # –ü–æ—Ä–æ–≥ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è heap dump (%)
```

## üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
```bash
./monitoring.sh [–æ–ø—Ü–∏—è]
```

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –æ–ø—Ü–∏–∏
1. –°–±–æ—Ä thread dumps:
```bash
./monitoring.sh thread
# –∏–ª–∏
./monitoring.sh 2
```

2. –ê–Ω–∞–ª–∏–∑ SQL:
```bash
./monitoring.sh sql
# –∏–ª–∏
./monitoring.sh 3
```

3. –°–±–æ—Ä –ª–æ–≥–æ–≤:
```bash
./monitoring.sh log
# –∏–ª–∏
./monitoring.sh 1
```

4. –ü–æ–ª–Ω—ã–π —Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö:
```bash
./monitoring.sh all
# –∏–ª–∏
./monitoring.sh 4
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

```
ERRORHOME/
‚îú‚îÄ‚îÄ YYYY-MM-DD-HH-MM/             # –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞ —Å–±–æ—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ process_info.log          # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ—Ü–µ—Å—Å–µ
‚îÇ   ‚îú‚îÄ‚îÄ thread_dumps/             # Thread dumps
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dump_1.txt
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dump_N.txt
‚îÇ   ‚îú‚îÄ‚îÄ memory/                   # –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–∞–º—è—Ç–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ heap.hprof
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ memory_pools.log
‚îÇ   ‚îú‚îÄ‚îÄ sql/                      # SQL –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ active_queries.csv
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ locks.csv
‚îÇ   ‚îî‚îÄ‚îÄ logs/                     # –õ–æ–≥–∏ WildFly
‚îî‚îÄ‚îÄ archives/                     # –ê—Ä—Ö–∏–≤—ã —Å–æ –≤—Å–µ–º–∏ –¥–∞–Ω–Ω—ã–º–∏
```

## üîç Thread Dumps

### –°–æ–±–∏—Ä–∞–µ–º–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- Stack traces –≤—Å–µ—Ö –ø–æ—Ç–æ–∫–æ–≤
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞—Ö
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–æ—Ç–æ–∫–æ–≤
- GC –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

### –ê–Ω–∞–ª–∏–∑ deadlocks
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è:
- –¶–∏–∫–ª–∏—á–µ—Å–∫–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- –ü—Ä–∏—á–∏–Ω—ã –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è
- –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ –ø–æ—Ç–æ–∫–∏

### Memory Analysis
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–±–æ—Ä—â–∏–∫–∞ –º—É—Å–æ—Ä–∞
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ memory pools
- –ê–Ω–∞–ª–∏–∑ —É—Ç–µ—á–µ–∫ –ø–∞–º—è—Ç–∏

## üìä SQL –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
- –ü–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –í—Ä–µ–º—è –æ–∂–∏–¥–∞–Ω–∏—è
- –ü—Ä–∏—á–∏–Ω—ã –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø –∫ –ª–æ–≥–∞–º WildFly
- –ü—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ JDK —É—Ç–∏–ª–∏—Ç
- –î–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–Ω—ã–º —Ç–∞–±–ª–∏—Ü–∞–º PostgreSQL

### Sensitive Data
- –ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –æ—Ç—á–µ—Ç–∞—Ö
- –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–µ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–µ—Å—Å–∏—è—Ö –∞–Ω–æ–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç—Å—è

## üîß –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –û–±—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
1. –°–∫—Ä–∏–ø—Ç –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ Java:
    - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é javahome
    - –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –Ω–∞–ª–∏—á–∏–∏ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

2. –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ PostgreSQL:
    - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    - –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

3. –û—à–∏–±–∫–∏ –ø—Ä–∏ —Å–±–æ—Ä–µ thread dumps:
    - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ jstack
    - –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –Ω–∞–ª–∏—á–∏–∏ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- –û—à–∏–±–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Å –ø–æ–ª–Ω—ã–º —Å—Ç–µ–∫—Ç—Ä–µ–π—Å–æ–º
- –î–æ—Å—Ç—É–ø–Ω–∞ –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
